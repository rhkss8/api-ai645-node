---
description:
globs:
alwaysApply: false
---
# TypeScript λΉλ“ μ¤λ¥ ν•΄κ²° κ°€μ΄λ“

## π¨ μμ£Ό λ°μƒν•λ” TypeScript λΉλ“ μ¤λ¥μ™€ ν•΄κ²°λ²•

### 1. Prisma κ΄€λ ¨ μ¤λ¥λ“¤

#### β `Property 'newModel' does not exist on type 'PrismaClient'`
```typescript
// μ¤λ¥ μμ‹
await this.prisma.recommendationParams.create(...)
// Property 'recommendationParams' does not exist
```

**β… ν•΄κ²°λ²•:**
```bash
# 1. Prisma ν΄λΌμ΄μ–ΈνΈ μ¬μƒμ„±
npx prisma generate

# 2. μ¤ν‚¤λ§κ°€ DBμ™€ λ™κΈ°ν™”λμ§€ μ•μ€ κ²½μ°
npx prisma db push
```

#### β `Type 'string | null' is not assignable to type 'InputJsonValue'`
```typescript
// μλ»λ μ½”λ“
conditions: params.conditions ? JSON.stringify(params.conditions) : null,
```

**β… ν•΄κ²°λ²•:**
```typescript
// μ¬λ°”λ¥Έ μ½”λ“
conditions: params.conditions ? JSON.stringify(params.conditions) : undefined,
```

### 2. μƒμ„±μ λ§¤κ°λ³€μ μ¤λ¥λ“¤

#### β `Expected X arguments, but got Y`
```typescript
// μ¤λ¥ μμ‹: RecommendationHistory μƒμ„±μ νΈμ¶
return new RecommendationHistory(
  prismaModel.id,
  prismaModel.userId,
  // ... 11κ° λ§¤κ°λ³€μμΈλ° μƒμ„±μλ” 12κ° μ”κµ¬
);
```

**β… ν•΄κ²°λ²•:**
1. μ—”ν‹°ν‹° μƒμ„±μ λ§¤κ°λ³€μ ν™•μΈ: [backend/src/entities/RecommendationHistory.ts](mdc:backend/src/entities/RecommendationHistory.ts)
2. λ¨λ“  λ§¤κ°λ³€μκ°€ μμ„λ€λ΅ μ „λ‹¬λλ”μ§€ ν™•μΈ
3. μƒλ΅ μ¶”κ°€λ ν•„λ“ (`orderId` λ“±) λ„λ½ ν™•μΈ

### 3. DI μ»¨ν…μ΄λ„ μ¤λ¥λ“¤

#### β `Property 'newUseCase' does not exist on type 'DIContainer'`
```typescript
// μλ»λ μμ„
this.newUseCase = new NewUseCase(); // μ¤λ¥ λ°μƒ!
```

**β… ν•΄κ²°λ²•:** [routes/index.ts](mdc:backend/src/routes/index.ts)μ—μ„
```typescript
// 1. λ¨Όμ € ν΄λμ¤ ν”„λ΅νΌν‹° μ„ μ–Έ
class DIContainer {
  private newUseCase!: NewUseCase; // μ„ μ–Έ ν•„μ!
  
  // 2. κ·Έ λ‹¤μ initializeDependencies()μ—μ„ μ΄κΈ°ν™”
  private initializeDependencies(): void {
    this.newUseCase = new NewUseCase(dependencies...);
  }
}
```

#### β `Expected 5 arguments, but got 3` (Controller μƒμ„±μ)
```typescript
// μ¤λ¥: RecommendationController μƒμ„±μ λ§¤κ°λ³€μ λ¶€μ΅±
this.recommendationController = new RecommendationController(
  this.generateRecommendationUseCase,
  this.extractImageNumbersUseCase,
  this.ipLimitService,
); // 5κ° ν•„μ”ν•λ° 3κ°λ§ μ „λ‹¬
```

**β… ν•΄κ²°λ²•:**
```typescript
// Controller μƒμ„±μ ν™•μΈ ν›„ λ¨λ“  μμ΅΄μ„± μ£Όμ…
this.recommendationController = new RecommendationController(
  this.generateRecommendationUseCase,
  this.prepareRecommendationUseCase,      // μ¶”κ°€
  this.generateFromOrderUseCase,          // μ¶”κ°€
  this.extractImageNumbersUseCase,
  this.ipLimitService,
);
```

### 4. νƒ€μ… νΈν™μ„± μ¤λ¥λ“¤

#### β `Type 'null' is not assignable to type 'UserConditions | undefined'`
```typescript
// μλ»λ μ½”λ“
RecommendationHistory.create(
  id,
  numbers,
  type,
  model,
  round,
  params.conditions, // nullμΌ μ μμ
  // ...
);
```

**β… ν•΄κ²°λ²•:**
```typescript
// nullμ„ undefinedλ΅ λ³€ν™
RecommendationHistory.create(
  id,
  numbers,
  type,
  model,
  round,
  params.conditions || undefined, // null β†’ undefined λ³€ν™
  params.imageData || undefined,
  // ...
);
```

## π› οΈ λΉλ“ μ¤λ¥ λ””λ²„κΉ… λ‹¨κ³„

### 1λ‹¨κ³„: μ¤λ¥ λ©”μ‹μ§€ μ •ν™•ν μ½κΈ°
```bash
# μƒμ„Έν• λΉλ“ μ¤λ¥ ν™•μΈ
cd backend
npm run build 2>&1 | tee build-error.log
```

### 2λ‹¨κ³„: μ¤λ¥ μ ν•λ³„ λ€μ‘
- **Prisma κ΄€λ ¨**: `npx prisma generate` λ¨Όμ € μ‹¤ν–‰
- **λ§¤κ°λ³€μ κ°μ**: μƒμ„±μ/λ©”μ„λ“ μ‹κ·Έλ‹μ² ν™•μΈ
- **νƒ€μ… λ¶μΌμΉ**: null/undefined μ²λ¦¬ ν™•μΈ
- **Property μ΅΄μ¬ν•μ§€ μ•μ**: DI μ»¨ν…μ΄λ„ ν”„λ΅νΌν‹° μ„ μ–Έ ν™•μΈ

### 3λ‹¨κ³„: λ‹¨κ³„λ³„ κ²€μ¦
```bash
# 1. Prisma ν΄λΌμ΄μ–ΈνΈ μµμ‹ ν™”
npx prisma generate

# 2. νƒ€μ… μ²΄ν¬λ§ μ‹¤ν–‰
npx tsc --noEmit

# 3. μ „μ²΄ λΉλ“
npm run build
```

## π” μμ£Ό λ†“μΉλ” μ²΄ν¬ν¬μΈνΈ

### μƒ μ—”ν‹°ν‹° μ¶”κ°€ μ‹
- [ ] [backend/src/entities/](mdc:backend/src/entities/) - μ—”ν‹°ν‹° ν΄λμ¤
- [ ] [backend/src/repositories/](mdc:backend/src/repositories/) - μΈν„°νμ΄μ¤
- [ ] [backend/src/repositories/impl/](mdc:backend/src/repositories/impl/) - κµ¬ν„μ²΄
- [ ] [backend/src/routes/index.ts](mdc:backend/src/routes/index.ts) - DI μ»¨ν…μ΄λ„ λ“±λ΅
- [ ] μƒμ„±μ λ§¤κ°λ³€μ μμ„ μΌμΉ ν™•μΈ

### μƒ API μ—”λ“ν¬μΈνΈ μ¶”κ°€ μ‹
- [ ] Controller λ©”μ„λ“ κµ¬ν„
- [ ] Routes νμΌμ— λ“±λ΅
- [ ] DI μ»¨ν…μ΄λ„μ— Controller μμ΅΄μ„± μ£Όμ…
- [ ] Swagger λ¬Έμ„ μ¶”κ°€
- [ ] TypeScript λΉλ“ μ„±κ³µ ν™•μΈ

## β΅ λΉ λ¥Έ ν•΄κ²° μ¤ν¬λ¦½νΈ

```bash
#!/bin/bash
# λΉλ“ μ¤λ¥ λΉ λ¥Έ ν•΄κ²° μ¤ν¬λ¦½νΈ

echo "π”§ Prisma ν΄λΌμ΄μ–ΈνΈ μ¬μƒμ„±..."
npx prisma generate

echo "π”§ λ°μ΄ν„°λ² μ΄μ¤ λ™κΈ°ν™”..."
npx prisma db push

echo "π”§ TypeScript λΉλ“ ν…μ¤νΈ..."
npm run build

if [ $? -eq 0 ]; then
    echo "β… λΉλ“ μ„±κ³µ! Docker μ¬λΉλ“ μ§„ν–‰..."
    cd .. && docker-compose down && docker-compose up -d --build
else
    echo "β λΉλ“ μ‹¤ν¨! μ¤λ¥λ¥Ό ν™•μΈν•μ„Έμ”."
    exit 1
fi
```

## π¨ λΉλ“ μ¤λ¥ λ°μƒ μ‹ μ λ€ κΈμ§€μ‚¬ν•­

1. **λΉλ“ μ¤λ¥ λ¬΄μ‹ν•κ³  Docker μ‹¤ν–‰ κΈμ§€**
   ```bash
   # β μ λ€ ν•μ§€ λ§μ„Έμ”
   docker-compose up -d --build  # λΉλ“ μ¤λ¥ μƒνƒμ—μ„ μ‹¤ν–‰
   ```

2. **νƒ€μ… μ¤λ¥λ¥Ό `any`λ΅ νν”Όν•μ§€ λ§μ„Έμ”**
   ```typescript
   // β μ„μ‹λ°©νΈ
   this.newRepository = new NewRepository() as any;
   
   // β… κ·Όλ³Έμ  ν•΄κ²°
   private newRepository!: INewRepository;
   ```

3. **Prisma μƒμ„± μ—†μ΄ μ¤ν‚¤λ§ λ³€κ²½ κΈμ§€**
   ```bash
   # β μ¤ν‚¤λ§ λ³€κ²½ ν›„ generate λ„λ½
   # schema.prisma μμ •
   npm run build  # μ¤λ¥ λ°μƒ!
   
   # β… μ¬λ°”λ¥Έ μμ„
   # schema.prisma μμ •
   npx prisma generate
   npm run build
   ```

---

**π’΅ ν•µμ‹¬: λΉλ“ μ¤λ¥λ” λ°λ“μ‹ ν•΄κ²°ν•κ³  λ„μ–΄κ°€κΈ°. μ„μ‹λ°©νΈ κΈμ§€!**
