#!/bin/bash

# λ§μ΄κ·Έλ μ΄μ…, μ‹λ“, μ„λ²„ μ‹μ‘ μ¤ν¬λ¦½νΈ

echo "π€ λ§μ΄κ·Έλ μ΄μ…, μ‹λ“, μ„λ²„ μ‹μ‘ μ¤ν¬λ¦½νΈ"
echo "=========================================="

# 1. ν™κ²½λ³€μ ν™•μΈ
echo "π“ 1. ν™κ²½λ³€μ ν™•μΈ"
if [ -z "$DATABASE_URL" ]; then
    echo "β DATABASE_URL ν™κ²½λ³€μκ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤."
    echo "CloudType λ€μ‹λ³΄λ“μ—μ„ DATABASE_URLμ„ μ„¤μ •ν•΄μ£Όμ„Έμ”."
    exit 1
else
    echo "β… DATABASE_URL μ„¤μ •λ¨"
fi

# 2. Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„±
echo ""
echo "π“ 2. Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„±"
npx prisma generate

if [ $? -eq 0 ]; then
    echo "β… Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„± μ„±κ³µ"
else
    echo "β Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„± μ‹¤ν¨"
    exit 1
fi

# 3. λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ λ™κΈ°ν™”
echo ""
echo "π“ 3. λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ λ™κΈ°ν™”"
npx prisma db push

if [ $? -eq 0 ]; then
    echo "β… λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ λ™κΈ°ν™” μ„±κ³µ"
else
    echo "β λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ λ™κΈ°ν™” μ‹¤ν¨"
    echo "β οΈ λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²°μ„ ν™•μΈν•΄μ£Όμ„Έμ”."
    exit 1
fi

# 4. μ‹λ“ λ°μ΄ν„° μ‹¤ν–‰
echo ""
echo "π“ 4. μ‹λ“ λ°μ΄ν„° μ‹¤ν–‰"
npx prisma db seed

if [ $? -eq 0 ]; then
    echo "β… μ‹λ“ λ°μ΄ν„° μ‹¤ν–‰ μ„±κ³µ"
else
    echo "β οΈ μ‹λ“ λ°μ΄ν„° μ‹¤ν–‰ μ‹¤ν¨ (κ³„μ† μ§„ν–‰)"
fi

# 5. μ„λ²„ μ‹μ‘
echo ""
echo "π“ 5. μ„λ²„ μ‹μ‘"
echo "π€ TypeScript λ΅λ μ¶”μ² API μ„λ²„κ°€ μ‹μ‘λμ—μµλ‹λ‹¤!"
npm run start:prod 